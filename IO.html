<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-11-03
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20151103" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Mellowtech Core &#x2013; Overview</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://www.mellowtech.org/projects/core" id="bannerLeft">
                <h2>Mellowtech Core</h2>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-11-03</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 3.0.3-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                                
      <li>
    
                          <a href="index.html" title="introduction">
          <i class="none"></i>
        introduction</a>
            </li>
                  
      <li>
    
                          <a href="byteStorables.html" title="byte storables">
          <i class="none"></i>
        byte storables</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>IO</a>
          </li>
                  
      <li>
    
                          <a href="sorting.html" title="sorting">
          <i class="none"></i>
        sorting</a>
            </li>
                  
      <li>
    
                          <a href="collections.html" title="collections">
          <i class="none"></i>
        collections</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                    
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Overview</h1>
<p>Mellowtech Core IO is an IO abstraction layer for working with files that contains data organized as records. The API is defined in RecordFile and SplitRecordFile respectively. A SplitRecordFile is a RecordFile with some added functionality.</p>
<p>You can create a record file with any of the following properties</p>

<ul>
  
<li><b>DISC</b> - This type of record file is backed up by a normal file and all read and writes are directly reflected in the file</li>
  
<li><b>MEM</b> - This type of record file uses NIO memory maps for reading and writing records</li>
  
<li><b>SPLIT</b> - This type of record file splits the file into two distinct regions of records. All read/writes are directly reflected in the file</li>
  
<li><b>MEM_SPLIT</b> - Same as split files but uses NIO memory maps for reading and writing records</li>
</ul>
<p>Common to all record files is that all have a <i>reseve</i> space in the beginning that can be used for storing additional non-record data. All record files are also backed by a single file and uses a memory mapped bit buffer for keeping track of free/full records. This means that a record file will always have a size overhead close to (num records / 8) bytes. So if you create a RecordFile with a capacity of 1M records it will have a size overhead of roughly 125K bytes. For MEM files this is slightly different since it sets the file size to the largest mapped region. So always expect file sizes to be larger than the actual data you store.</p>
<p><b>Never assume that the various record files are binary compatible</b></p>
<div class="section">
<h2><a name="Creating_and_Using_RecordFiles"></a>Creating and Using RecordFiles</h2>
<p>The preferred way of creating files is to use the RecordFileBuilder, then you don&#x2019;t need to worry about which underlying implementation to use. Lets say you want to instantiate a memory mapped RecordFile.</p>

<div class="source">
<div class="source">
<pre>RecordFileBuilder builder = new RecordFileBuilder();
builder.blockSize(2048).mem().reserve(0).maxBlocks(1024*1024);
RecordFile rf = builder.build(&quot;/tmp/myfile.rf&quot;);
System.out.println(&quot;free blocks: &quot;+rf.getFreeBlocks());
</pre></div></div>
<p>This would create a memory mapped record file that can store 1M of records of size 2048K. To add records you use the insert method</p>

<div class="source">
<div class="source">
<pre>byte[] b = new CBString(&quot;first string&quot;).to().array();
byte[] b1 = new CBString(&quot;second string&quot;).to().array();
rf.insert(100000, b);
rf.insert(512, b1);
</pre></div></div>
<p>To retrieve your records you use the get method</p>

<div class="source">
<div class="source">
<pre>b = rf.get(100000);
CBString str = new CBString().from(b, 0);
System.out.println(str.get());
</pre></div></div>
<p>You can also iterate over your record file. This will iterate over all set records</p>

<div class="source">
<div class="source">
<pre>CBString tmp = new CBString();
for(Iterator&lt;Record&gt;iter = rf.iterator(); iter.hasNext();){
  Record r = iter.next();
  System.out.println(&quot;record: &quot;+r.record+&quot; &quot;+tmp.from(r.data,0));
}
</pre></div></div>
<div class="section">
<h3><a name="Dynamically_Sized_Records"></a>Dynamically Sized Records</h3>
<p>In some circumstances you will need a way of allocating records that can grow and shrink in size. That is, you might need one record that is 100K in size and another that is only 1K in size. Creating a RecordFile with record sizes to handle your largest record might result in a lot of wasted space (and you might not even know the maximum size to start with). For this you can use the SpannedBlockFile and IteratingSpannedBlockFile.</p>
<p>The easiest way to create a SpannedBlockFile is to use the RecordFileBuilder</p>

<div class="source">
<div class="source">
<pre>builder.span(true).iterate(true)
</pre></div></div>
<p>This would create a spanning block file that you can iterate over. You can turn any of the underlying block files (mem, split, disc, memsplit) to spanned one.</p>
<p><b>Observe</b> that a spanned block file that you can iterate over will use the reserve space to store a bitset so you will not be able to use the reserve space for other purposes</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2015.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
